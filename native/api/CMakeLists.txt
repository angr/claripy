message(STATUS "Configuring API target: ${API_TARGET}")
include(gen_api_file)

# Config
set(AUTOGEN_CPP "${CMAKE_CURRENT_SOURCE_DIR}/autogen.cpp")

# Headers
set(AUTOGEN_INCLUDES
    "${CMAKE_CURRENT_SOURCE_DIR}/manual.hpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/headers.hpp"
)

# Gen API files
gen_api_file(
    "${API_TARGET}"
    "${AUTOGEN_CPP}"
    "${CMAKE_CURRENT_SOURCE_DIR}/binder/raw_output/"
    ${AUTOGEN_INCLUDES}
)

# Configure target
message(STATUS "Configuring API target...")
pybind11_add_module("${API_TARGET}")
target_include_directories("${API_TARGET}" SYSTEM PRIVATE "${CLARICPP_SRC}/..")
target_sources(clari PRIVATE
	"${AUTOGEN_CPP}"
    signal_handler.cpp
    py_shim_code.cpp
    exceptions.cpp
	backtrace.cpp
	simplify.cpp
	globals.cpp
    manual.cpp
	py_obj.cpp
	log.cpp
)
target_link_libraries("${API_TARGET}" PUBLIC "${CLARICPP}")

# Code quality exceptions for auto-generated code
message(STATUS "Permitting and suppressing warnings for auto-generated code...")
set_source_files_properties(${AUTOGEN_CPP} PROPERTIES COMPILE_FLAGS "-Wno-error -w")
message("Autogenerated API code configured!")

# Clean file
message(STATUS "Updating clean target to clean autogenerated file: ${AUTOGEN_CPP}")
set_property(TARGET "${API_TARGET}"
    APPEND PROPERTY ADDITIONAL_CLEAN_FILES
    "${AUTOGEN_CPP}"
)