message(STATUS "Configuring API")
include(gen_api_file)

# Config
set(AUTOGEN_CPP "${CMAKE_CURRENT_SOURCE_DIR}/autogen.cpp")

# Gen main API file
gen_api_file(
	"${CLARICPP}"
    "${AUTOGEN_CPP}"
    "${CMAKE_CURRENT_SOURCE_DIR}/binder/raw_output/"
	# Includes
	"${CMAKE_CURRENT_SOURCE_DIR}/manual.hpp"
	"${CMAKE_CURRENT_SOURCE_DIR}/headers.hpp"
)

# Configure target
message(STATUS "Configuring API target...")
target_sources("${CLARICPP}" PRIVATE
	"${AUTOGEN_CPP}"
    signal_handler.cpp
    py_shim_code.cpp
    exceptions.cpp
	backtrace.cpp
	simplify.cpp
	globals.cpp
    manual.cpp
	py_obj.cpp
	log.cpp
)

# Code quality exceptions for auto-generated code
message(STATUS "Permitting and suppressing warnings for auto-generated code...")
set_source_files_properties(${AUTOGEN_CPP} PROPERTIES COMPILE_FLAGS "-Wno-error -w")
message("Autogenerated API code configured!")
set_source_files_properties(
		"${AUTOGEN_CPP}"
		TARGET_DIRECTORY "${CLARICPP}" # Properties are scoped by directory so this is needed
		PROPERTIES COMPILE_FLAGS "-Wno-error -w"
)

# Clean file
message(STATUS "Updating clean target to clean autogenerated file: ${AUTOGEN_CPP}")
set_property(TARGET "${CLARICPP}"
    APPEND PROPERTY ADDITIONAL_CLEAN_FILES
    "${AUTOGEN_CPP}"
)